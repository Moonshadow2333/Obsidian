---
aliases: 
date: 2025-04-25
---


# 目录

```dataviewjs
const startHeadinglevel = 2;
const file = app.workspace.getActiveFile();
const { headings } = app.metadataCache.getFileCache(file);
 
// 全列表的形式
const raws = headings.filter(row => row.heading != "目录").map( p => {
    let repeatCount = Math.max((p.level - startHeadinglevel) * 4, 0);
    let spacesPrefix = ' '.repeat( repeatCount + 4 );
    let listSign = repeatCount > 0 ? '- ' : '';
    let linkText = `[[#${p.heading}]]`;
    let headingList = (p.level < startHeadinglevel) ? `- ${linkText}` : `${spacesPrefix}- ${linkText}`;
    return headingList;
  }
)
 
let result = raws.join('\n');
// 添加行距
dv.container.style.lineHeight = "1.5em";
dv.paragraph(result)
```

# 开通权限



为指定 IP 开放红旗 Linux（Red Flag Linux）的 `10022` 端口访问权限（如 SSH 服务），需通过防火墙规则和 SELinux 策略配置。以下是详细步骤：

---

### **一、防火墙配置**
#### **1. 确认防火墙工具**
红旗 Linux 通常使用 `firewalld` 或 `iptables` 管理防火墙。  
- 检查防火墙状态：  
  ```bash
  systemctl status firewalld   # 查看 firewalld 是否运行
  systemctl status iptables    # 查看 iptables 是否运行
  ```

#### **2. 配置规则（以 `firewalld` 为例）**
若使用 `firewalld`，通过富规则（Rich Rule）允许指定 IP 访问端口：
```bash
# 添加规则（将 192.168.1.100 替换为实际 IP）
sudo firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.1.100" port port="10022" protocol="tcp" accept'

# 重新加载防火墙
sudo firewall-cmd --reload
```

#### **3. 配置规则（以 `iptables` 为例）**
若使用 `iptables`，直接添加规则并保存：
```bash
# 允许指定 IP 访问 10022 端口
sudo iptables -A INPUT -p tcp -s 192.168.1.100 --dport 10022 -j ACCEPT

# 保存规则（根据系统选择）
sudo service iptables save    # CentOS 6 或旧版
sudo iptables-save > /etc/sysconfig/iptables  # 手动保存
```

---

### **二、SELinux 配置**
若 SELinux 处于 `Enforcing` 模式，需授权端口：
```bash
# 查看 SELinux 状态
getenforce

# 为 10022 端口添加 SELinux 策略
sudo semanage port -a -t ssh_port_t -p tcp 10022

# 若 semanage 未安装
sudo yum install policycoreutils-python -y
```

---

### **三、服务配置验证**
#### **1. 确认服务监听端口**
检查 SSH 服务是否监听了 `10022` 端口：
```bash
# 修改 SSH 配置文件（若需要）
sudo vi /etc/ssh/sshd_config
```
确保存在以下配置：
```ini
Port 22       # 默认端口（可选）
Port 10022    # 新增端口
```

#### **2. 重启 SSH 服务**
```bash
sudo systemctl restart sshd
```

---

### **四、测试连接**
从指定 IP 的客户端测试访问：
```bash
ssh -p 10022 username@服务器IP
```

---

### **五、安全建议**
1. **最小化开放范围**：仅允许必要 IP 或 IP 段。
2. **密钥认证**：禁用密码登录，使用 SSH 密钥认证。
3. **日志监控**：定期检查 `/var/log/secure` 中的 SSH 日志。
4. **防火墙默认策略**：默认拒绝所有入站流量，仅放行必要端口。

---

通过以上步骤，指定 IP 即可安全访问红旗 Linux 的 `10022` 端口

# SELinux



若 SELinux 处于 **Enforcing** 模式（默认严格策略），需额外配置以允许端口访问。以下是针对 SELinux 的详细操作步骤和原理说明：

---

### **1. 确认 SELinux 状态**
```bash
getenforce   # 查看当前模式（Enforcing/Permissive/Disabled）
```

- **Enforcing**：强制模式，拦截未授权的操作。  
- **Permissive**：宽容模式，仅记录不拦截。  
- **Disabled**：完全禁用（不建议，降低安全性）。

---

### **2. 检查端口是否已被 SELinux 允许**
```bash
sudo semanage port -l | grep ssh_port_t
```
输出示例：  
```
ssh_port_t                    tcp      22
```
若未显示 `10022`，需手动添加。

---

### **3. 授权端口给 SELinux**
使用 `semanage` 工具添加端口规则：
```bash
# 添加 10022 端口到 ssh_port_t 类型（SSH 默认类型）
sudo semanage port -a -t ssh_port_t -p tcp 10022
```

#### **参数解释**：
- `-a`：添加规则。  
- `-t ssh_port_t`：指定端口类型（与 SSH 相同）。  
- `-p tcp`：协议类型。  
- `10022`：目标端口。

---

### **4. 若 `semanage` 命令不存在（常见问题）**
安装 SELinux 管理工具：
```bash
# 适用于 CentOS/RHEL/红旗等基于 RPM 的系统
sudo yum install policycoreutils-python -y
```

---

### **5. 验证端口规则**
```bash
sudo semanage port -l | grep ssh_port_t
```
输出应包含 `10022`：
```
ssh_port_t                    tcp      10022, 22
```

---

### **6. 临时调试 SELinux（可选）**
若不确定问题是否由 SELinux 引起，可临时切换为宽容模式：
```bash
sudo setenforce 0   # 临时切换为 Permissive 模式
# 测试服务是否正常工作
sudo setenforce 1   # 恢复 Enforcing 模式
```

---

### **7. 查看 SELinux 日志定位问题**
若端口授权后仍无法访问，检查 SELinux 拦截日志：
```bash
sudo tail -f /var/log/audit/audit.log | grep avc
```
或使用工具分析：
```bash
sudo ausearch -m avc -ts recent | audit2why
```

---

### **8. 自定义 SELinux 策略（高级场景）**
若默认类型（如 `ssh_port_t`）不适用，可创建自定义策略模块：
```bash
# 生成策略模块模板
sudo ausearch -m avc -ts recent | audit2allow -M my_custom_port
# 编译并加载模块
sudo semodule -i my_custom_port.pp
```

---

### **9. 恢复默认配置（如需撤销）**
```bash
# 删除端口规则
sudo semanage port -d -t ssh_port_t -p tcp 10022
```

---

### **关键原理**
- **SELinux 上下文**：SELinux 通过端口类型（如 `ssh_port_t`）限制服务访问权限，即使防火墙允许，若 SELinux 未授权，仍会拦截。  
- **最小权限原则**：仅开放必要端口和类型，避免直接禁用 SELinux。

---

### **总结**
通过以上步骤，SELinux 将允许 `10022` 端口的 TCP 流量（如 SSH 服务），与防火墙规则配合，确保指定 IP 可安全访问。

# 异常



---

当 `netstat -an | grep 10022` 无输出，但 `iptables` 显示开放了 `10022` 端口时，通常有以下几种原因。以下是逐步排查和解决方案：

---

### **1. 服务未监听 10022 端口**
即使防火墙开放了端口，若没有服务监听该端口，`netstat` 也不会显示。

#### **检查服务是否监听端口**：
```bash
sudo netstat -tuln | grep 10022   # 查看 TCP/UDP 监听端口
# 或使用更现代的命令
sudo ss -tuln | grep 10022
```
- **若无输出**：说明没有服务在 `10022` 端口监听。
- **若有输出**：检查服务名称（最后一列），例如 `sshd` 表示 SSH 服务。

#### **解决方案**：
- **确认服务配置**：例如，SSH 服务需在 `/etc/ssh/sshd_config` 中配置 `Port 10022`。
- **重启服务**：修改配置后需重启服务：
  ```bash
  sudo systemctl restart sshd   # 以 SSH 为例
  ```

---

### **2. 服务绑定到 IPv4/IPv6 的特定地址**
某些服务可能仅监听 `127.0.0.1`（本地回环）或特定 IP，而非 `0.0.0.0`（所有地址）。

#### **检查监听地址**：
```bash
sudo netstat -tuln | grep 10022
```
- 输出示例：  
  ```
  tcp   0   0 127.0.很抱歉，当前遇到了一些问题，请稍后重试