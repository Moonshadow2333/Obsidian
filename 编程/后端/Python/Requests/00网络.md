---
aliases:
  - Requests
date: 2025-05-12
---

# 目录

```dataviewjs
const startHeadinglevel = 2;
const file = app.workspace.getActiveFile();
const { headings } = app.metadataCache.getFileCache(file);
 
// 全列表的形式
const raws = headings.filter(row => row.heading != "目录").map( p => {
    let repeatCount = Math.max((p.level - startHeadinglevel) * 4, 0);
    let spacesPrefix = ' '.repeat( repeatCount + 4 );
    let listSign = repeatCount > 0 ? '- ' : '';
    let linkText = `[[#${p.heading}]]`;
    let headingList = (p.level < startHeadinglevel) ? `- ${linkText}` : `${spacesPrefix}- ${linkText}`;
    return headingList;
  }
)
 
let result = raws.join('\n');
// 添加行距
dv.container.style.lineHeight = "1.5em";
dv.paragraph(result)
```

# 区分响应

在Python中，可以通过以下步骤区分`requests`库的响应是JSON还是字符串：

### 方法步骤：
1. **检查响应头中的Content-Type**：  
   查看`Content-Type`是否包含`application/json`，若是则视为JSON格式。
   
2. **尝试解析响应内容为JSON**：  
   若`Content-Type`不明确或不可信，尝试调用`.json()`方法，成功则为JSON，失败则为字符串。

### 示例代码：
```python
import requests

def get_response_type(response):
    # 检查Content-Type是否为JSON
    content_type = response.headers.get('Content-Type', '').lower()
    if 'application/json' in content_type:
        return 'json'
    
    # 尝试解析内容是否为JSON
    try:
        response.json()  # 若成功解析，则返回'json'
        return 'json'
    except ValueError:
        return 'text'

# 示例请求
url = 'https://api.example.com/data'
response = requests.get(url)

# 判断响应类型
resp_type = get_response_type(response)

if resp_type == 'json':
    data = response.json()
    print("JSON数据:", data)
else:
    text = response.text
    print("字符串内容:", text)
```

### 说明：
- **`Content-Type`检查**：快速判断服务器声明的数据类型。
- **`.json()`解析**：确保即使`Content-Type`未正确设置，仍能正确识别有效JSON。
- **异常处理**：若JSON解析失败（如内容无效），捕获`ValueError`，判定为字符串。

### 注意事项：
- **空响应**：若响应内容为空（如HTTP 204），`.json()`会抛出错误，需额外处理。
- **性能**：多次调用`.json()`不会重复解析，因为`requests`会缓存结果。