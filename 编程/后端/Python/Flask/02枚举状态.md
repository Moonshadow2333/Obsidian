---
aliases:
  - Flask
date: 2025-05-07
---

# 目录

```dataviewjs
const startHeadinglevel = 2;
const file = app.workspace.getActiveFile();
const { headings } = app.metadataCache.getFileCache(file);
 
// 全列表的形式
const raws = headings.filter(row => row.heading != "目录").map( p => {
    let repeatCount = Math.max((p.level - startHeadinglevel) * 4, 0);
    let spacesPrefix = ' '.repeat( repeatCount + 4 );
    let listSign = repeatCount > 0 ? '- ' : '';
    let linkText = `[[#${p.heading}]]`;
    let headingList = (p.level < startHeadinglevel) ? `- ${linkText}` : `${spacesPrefix}- ${linkText}`;
    return headingList;
  }
)
 
let result = raws.join('\n');
// 添加行距
dv.container.style.lineHeight = "1.5em";
dv.paragraph(result)
```



在 Flask 中通过枚举值和统一响应格式，可以提升 API 的一致性和可维护性。以下是完整实现方案：

---

### 一、定义枚举类 - `utils/enums.py`
```python
from enum import Enum

class ApiCode(Enum):
    """API 状态码枚举"""
    SUCCESS = (200, "成功")
    PARAM_ERROR = (400, "参数错误")
    AUTH_FAILED = (401, "认证失败")
    NOT_FOUND = (404, "资源不存在")
    SERVER_ERROR = (500, "服务器内部错误")

    def __init__(self, code, msg):
        self.code = code
        self.msg = msg
```

---

### 二、统一响应格式 - `utils/response.py`
```python
from flask import jsonify
from typing import Any, Dict

def json_response(
    code_enum: ApiCode, 
    data: Any = None, 
    **kwargs: Dict
) -> dict:
    """
    统一 JSON 响应格式
    :param code_enum: ApiCode 枚举实例
    :param data: 业务数据
    :param kwargs: 扩展字段 (如分页信息)
    """
    result = {
        "code": code_enum.code,
        "msg": code_enum.msg,
        "data": data
    }
    result.update(kwargs)  # 合并额外参数
    return jsonify(result)
```

#### result.update

**`result.update()`** 是 Python 字典的方法，用于将另一个字典（或键值对）合并到当前字典中。若键已存在，则覆盖其值；不存在则新增。

**示例**：
```python
dict1 = {'a': 1, 'b': 2}
dict1.update({'b': 3, 'c': 4})
print(dict1)  # {'a': 1, 'b': 3, 'c': 4}
```

**用途**：快速合并多个字典或扩展数据。

---

### 三、在路由中使用 - `routes/user.py`
```python
from flask import Blueprint, request
from utils.response import json_response
from utils.enums import ApiCode

user_bp = Blueprint('user', __name__)

@user_bp.route('/users/<int:user_id>')
def get_user(user_id):
    # 模拟数据库查询
    user = {"id": user_id, "name": "John"}
    if not user:
        return json_response(ApiCode.NOT_FOUND)
    return json_response(ApiCode.SUCCESS, data=user)

@user_bp.route('/users', methods=['POST'])
def create_user():
    data = request.get_json()
    if 'name' not in data:
        return json_response(ApiCode.PARAM_ERROR, msg="缺少用户名")
    # 创建用户逻辑...
    return json_response(ApiCode.SUCCESS, data={"id": 1})
```

---

### 四、全局错误处理 - `app.py`
```python
from flask import Flask
from utils.response import json_response
from utils.enums import ApiCode

app = Flask(__name__)

# 注册蓝图
from routes import user
app.register_blueprint(user.user_bp, url_prefix='/api')

@app.errorhandler(404)
def handle_404(e):
    return json_response(ApiCode.NOT_FOUND)

@app.errorhandler(500)
def handle_500(e):
    return json_response(ApiCode.SERVER_ERROR)

# 自定义异常处理
class BizException(Exception):
    def __init__(self, code_enum: ApiCode, msg=None):
        self.code_enum = code_enum
        self.msg = msg or code_enum.msg

@app.errorhandler(BizException)
def handle_biz_exception(e):
    return json_response(e.code_enum, msg=e.msg)
```

---

### 五、数据库模型转换工具 - `utils/db.py`
```python
def model_to_dict(model):
    """ORM 模型转字典"""
    if not model:
        return None
    return {c.name: getattr(model, c.name) for c in model.__table__.columns}

def paginate_result(query, page=1, page_size=10):
    """分页处理工具"""
    pagination = query.paginate(page=page, per_page=page_size, error_out=False)
    return {
        "items": [model_to_dict(item) for item in pagination.items],
        "total": pagination.total,
        "pages": pagination.pages,
        "current_page": pagination.page
    }
```

---

### 六、完整请求示例
#### 1. 成功响应
```json
{
  "code": 200,
  "msg": "成功",
  "data": {
    "id": 1,
    "name": "John"
  }
}
```

#### 2. 参数错误
```json
{
  "code": 400,
  "msg": "参数错误",
  "data": null
}
```

#### 3. 分页数据
```json
{
  "code": 200,
  "msg": "成功",
  "data": {
    "items": [/* 数据列表 */],
    "total": 100,
    "pages": 10,
    "current_page": 1
  }
}
```

---

### 七、优势总结
| 特性             | 说明                                                                 |
|------------------|--------------------------------------------------------------------|
| **统一格式**      | 所有接口返回标准化 JSON 结构                                        |
| **枚举管理**      | 状态码和提示信息集中维护，避免硬编码                                 |
| **错误处理**      | 全局捕获 HTTP 异常和业务异常                                        |
| **扩展性**        | 支持分页、额外字段等场景                                            |
| **类型安全**      | 结合 Type Hints 提升代码可读性 (Python 3.5+)                        |

通过此方案，可以快速构建标准化、易维护的 Flask API 服务。