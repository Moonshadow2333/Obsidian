# 插入排序

## 循环不变量

`a[0...i)` 有序，`a[i...n)` 无序；

``` PHP
public static function sort(array $arr)
{
    for ($i = 0; $i < count($arr); $i++) {
        $t = $arr[$i];
        for ($j = $i; $j - 1 >= 0 && $t < $arr[$j - 1]; $j--) {
            $arr[$j] = $arr[$j - 1];
        }
        $arr[$j] = $t;
    }
    return $arr;
}
```

`$arr = [1, 4, 3, 2, 6, 5];`

有一个关键的地方：就是如何把 `a[i]` 放到合适的位置？换句话说为什么经过内层循环之后就可以直接把 `a[i]` 放到循环终止时 `a[j]` 的位置？

内层循环：

```PHP
$t = $arr[$i];
for ($j = $i; $j - 1 >= 0 && $t < $arr[$j - 1]; $j--) {
    $arr[$j] = $arr[$j - 1];
}
```

先看一个简单的例子：

```PHP
$arr = [1, 4, 3, 2, 6, 5];
for ($j = count($arr) - 1; $j - 1 >= 0; $j--) {
    $arr[$j] = $arr[$j - 1];
}
```

结果如下：

```PHP
array(6) {
  [0]=>
  int(1)
  [1]=>
  int(1)
  [2]=>
  int(4)
  [3]=>
  int(3)
  [4]=>
  int(2)
  [5]=>
  int(6)
}
```

这个数组的所有元素都往前挪了一个位置。但是有两个特殊的位置：

- `arr[0]` 覆盖了 `a[1]`， 但是没有元素覆盖 `a[0]`，所以 `a[0]` 的值不变。
- `arr[5]` 被 `a[4]` 覆盖，但是 `a[5]` 没有覆盖别人，所以 `a[5]` 的值消失了；

一个是没有元素可覆盖，一个是没有被其他元素覆盖。

假如让最后一个元素覆盖第一个元素的值：

```PHP
$arr = [1,4,3,2,6,5];
$t = $arr[5];
for ($j = count($arr) - 1; $j - 1 >= 0; $j--) {
    $arr[$j] = $arr[$j - 1];
}
$arr[$j] = $t;
```

结果如下：

```PHP
array(6) {
  [0]=>
  int(5)
  [1]=>
  int(1)
  [2]=>
  int(4)
  [3]=>
  int(3)
  [4]=>
  int(2)
  [5]=>
  int(6)
}
```

假如我们要排序数组 `[1, 3, 4, 2]`。

从 `arr[1]` 开始所有的元素整体往后挪一个位置，再把最后一个元素的值 2 和 `arr[1]` 的元素互换。

我们单独把 `[3, 4, 2]` 拿出来处理：

```PHP
$arr = [3, 4, 2];
$t = $arr[2];
for ($j = count($arr) - 1; $j - 1 >= 0;  $j--) {
    $arr[$j] = $arr[$j - 1];
}
$arr[0] = $t;
```

结果如下：

```PHP
array(3) {
  [0]=>
  int(2)
  [1]=>
  int(3)
  [2]=>
  int(4)
}
```

为什么是 `arr[1]`？即为什么要从 `arr[1]` 开始，所有的元素整体往后挪一个位置？

观察这个数组 `[1, 3, 4, 2]`，可以发现 `arr[3]` 前面的元素 `[1, 3, 4]` 是有序的，想要实现数组 `[1, 3, 4, 2]` 的排序，只要把比 2 大的元素往后挪一个位置，即只要再加一个判断即可：

```PHP
$arr = [1, 3, 4, 2];
$t = $arr[count($arr) - 1];
for ($j = count($arr) - 1; $j - 1 >= 0 && $t < $arr[$j - 1];  $j--) {
    $arr[$j] = $arr[$j - 1];
}
$arr[$j] = $t;
```

结果如下：

```PHP
array(4) {
  [0]=>
  int(1)
  [1]=>
  int(2)
  [2]=>
  int(3)
  [3]=>
  int(4)
}
```
